<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>钓鱼网站检测系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .hero-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .detection-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .detection-card:hover {
            transform: translateY(-5px);
        }

        .result-card {
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .result-safe {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .result-phishing {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .url-input {
            border-radius: 25px;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .detect-btn {
            border-radius: 25px;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transition: all 0.3s ease;
        }

        .detect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .confidence-bar {
            height: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            overflow: hidden;
            margin: 1rem 0;
        }

        .confidence-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section text-center text-white">
            <h1 class="display-4 mb-4">
                <i class="fas fa-shield-alt me-3"></i>
                钓鱼网站检测系统
            </h1>
            <p class="lead mb-4">
                基于机器学习的智能钓鱼网站识别 | 实时检测 | 高准确率
            </p>
            <div class="row">
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="fas fa-globe fa-2x mb-2 text-primary"></i>
                        <div class="stats-number" id="totalWebsites">0</div>
                        <div class="text-muted">已检测网站</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2 text-danger"></i>
                        <div class="stats-number" id="phishingCount">0</div>
                        <div class="text-muted">发现钓鱼网站</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="fas fa-chart-line fa-2x mb-2 text-success"></i>
                        <div class="stats-number" id="accuracyRate">0%</div>
                        <div class="text-muted">检测准确率</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="fas fa-clock fa-2x mb-2 text-info"></i>
                        <div class="stats-number" id="avgTime">0ms</div>
                        <div class="text-muted">平均检测时间</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detection Section -->
        <div class="detection-card">
            <h2 class="text-center mb-4">
                <i class="fas fa-search me-2"></i>
                网站安全检测
            </h2>

            <div class="row">
                <div class="col-md-8">
                    <div class="input-group">
                        <input type="url" class="form-control url-input" id="urlInput"
                               placeholder="请输入要检测的网站URL (例如: https://example.com)">
                        <button class="btn detect-btn" onclick="detectWebsite()">
                            <i class="fas fa-search me-2"></i>开始检测
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="d-grid">
                        <button class="btn btn-outline-primary" onclick="batchDetect()">
                            <i class="fas fa-list me-2"></i>批量检测
                        </button>
                    </div>
                </div>
            </div>

            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">检测中...</span>
                </div>
                <p class="mt-2">正在分析网站，请稍候...</p>
            </div>

            <div id="resultContainer" style="display: none;">
                <!-- 检测结果将在这里显示 -->
            </div>
        </div>

        <!-- Features Section -->
        <div class="row">
            <div class="col-md-4">
                <div class="stats-card">
                    <i class="fas fa-robot fa-3x mb-3 text-primary"></i>
                    <h4>AI 驱动</h4>
                    <p>使用多种机器学习算法进行集成学习，提供高准确率的检测结果</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <i class="fas fa-bolt fa-3x mb-3 text-warning"></i>
                    <h4>实时检测</h4>
                    <p>快速分析网站特征，包括URL结构、HTTP响应头、HTML内容等</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <i class="fas fa-shield-alt fa-3x mb-3 text-success"></i>
                    <h4>全方位保护</h4>
                    <p>检测SSL证书、JavaScript代码、表单安全等多个维度的威胁</p>
                </div>
            </div>
        </div>

        <!-- Recent Detections -->
        <div class="detection-card">
            <h3 class="mb-4">
                <i class="fas fa-history me-2"></i>
                最近检测记录
            </h3>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>URL</th>
                            <th>检测结果</th>
                            <th>置信度</th>
                            <th>检测时间</th>
                        </tr>
                    </thead>
                    <tbody id="recentDetections">
                        <tr>
                            <td colspan="4" class="text-center text-muted">暂无检测记录</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // 页面加载时初始化
        $(document).ready(function() {
            loadStatistics();
            loadRecentDetections();
        });

        // 加载统计信息
        function loadStatistics() {
            $.get('/api/statistics', function(data) {
                $('#totalWebsites').text(data.websites.total.toLocaleString());
                $('#phishingCount').text(data.websites.phishing.toLocaleString());
                $('#accuracyRate').text('95.2%'); // 可以从模型状态获取
                $('#avgTime').text('245ms');
            }).fail(function() {
                console.error('Failed to load statistics');
            });
        }

        // 加载最近检测记录
        function loadRecentDetections() {
            $.get('/api/recent_predictions?limit=10', function(data) {
                const tbody = $('#recentDetections');
                tbody.empty();

                if (data.predictions.length === 0) {
                    tbody.append('<tr><td colspan="4" class="text-center text-muted">暂无检测记录</td></tr>');
                    return;
                }

                data.predictions.forEach(function(prediction) {
                    const row = $('<tr>');
                    const urlCell = $('<td>').text(prediction.url).attr('title', prediction.url);
                    urlCell.css('max-width', '300px');
                    urlCell.css('overflow', 'hidden');
                    urlCell.css('text-overflow', 'ellipsis');
                    urlCell.css('white-space', 'nowrap');

                    const resultCell = $('<td>');
                    const resultBadge = $('<span>')
                        .addClass('badge')
                        .text(prediction.predicted_label ? '钓鱼网站' : '安全网站');

                    if (prediction.predicted_label) {
                        resultBadge.addClass('bg-danger');
                    } else {
                        resultBadge.addClass('bg-success');
                    }

                    resultCell.append(resultBadge);

                    const confidenceCell = $('<td>').text((prediction.confidence_score * 100).toFixed(1) + '%');
                    const timeCell = $('<td>').text(new Date(prediction.prediction_time).toLocaleString());

                    row.append(urlCell, resultCell, confidenceCell, timeCell);
                    tbody.append(row);
                });
            }).fail(function() {
                console.error('Failed to load recent detections');
            });
        }

        // 检测网站
        function detectWebsite() {
            const url = $('#urlInput').val().trim();

            if (!url) {
                alert('请输入要检测的URL');
                return;
            }

            // 显示加载动画
            $('#loadingSpinner').show();
            $('#resultContainer').hide();

            // 发送检测请求
            $.ajax({
                url: '/api/detect',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ url: url }),
                success: function(result) {
                    $('#loadingSpinner').hide();
                    displayResult(result);
                },
                error: function(xhr) {
                    $('#loadingSpinner').hide();
                    const error = xhr.responseJSON?.error || '检测失败';
                    showError(error);
                }
            });
        }

        // 显示检测结果
        function displayResult(result) {
            const container = $('#resultContainer');
            container.empty();

            if (result.error) {
                showError(result.error);
                return;
            }

            const isPhishing = result.is_phishing;
            const confidence = (result.confidence * 100).toFixed(1);

            const resultCard = $('<div>').addClass('result-card');

            if (isPhishing) {
                resultCard.addClass('result-phishing');
            } else {
                resultCard.addClass('result-safe');
            }

            const icon = isPhishing ? 'fas fa-exclamation-triangle' : 'fas fa-check-circle';
            const title = isPhishing ? '⚠️ 检测到钓鱼网站' : '✅ 网站安全';
            const description = isPhishing ?
                '该网站具有钓鱼网站的特征，建议不要访问或输入敏感信息。' :
                '该网站未发现明显的安全威胁，可以正常访问。';

            resultCard.html(`
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4><i class="${icon} me-2"></i>${title}</h4>
                        <p class="mb-2">${description}</p>
                        <div class="mb-2">
                            <strong>URL:</strong> <code>${result.url}</code>
                        </div>
                        <div class="mb-2">
                            <strong>置信度:</strong> ${confidence}%
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${confidence}%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="display-4 mb-2">
                            <i class="${icon}"></i>
                        </div>
                        <div class="h5">${confidence}%</div>
                        <small>置信度</small>
                    </div>
                </div>
            `);

            container.append(resultCard);

            // 显示详细信息
            if (result.individual_predictions) {
                const detailsCard = $('<div>').addClass('card mt-3');
                detailsCard.html(`
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>模型预测详情</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            ${Object.entries(result.individual_predictions).map(([model, pred]) => `
                                <div class="col-md-6 mb-2">
                                    <div class="d-flex justify-content-between">
                                        <span>${model}</span>
                                        <span class="badge ${pred.prediction ? 'bg-danger' : 'bg-success'}">
                                            ${(pred.confidence * 100).toFixed(1)}%
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `);
                container.append(detailsCard);
            }

            container.show();

            // 重新加载统计和最近检测
            loadStatistics();
            loadRecentDetections();
        }

        // 显示错误信息
        function showError(message) {
            const container = $('#resultContainer');
            container.empty();

            const errorCard = $('<div>').addClass('alert alert-danger');
            errorCard.html(`
                <h5><i class="fas fa-exclamation-circle me-2"></i>检测失败</h5>
                <p>${message}</p>
            `);

            container.append(errorCard);
            container.show();
        }

        // 批量检测
        function batchDetect() {
            const urls = prompt('请输入要检测的URL（每行一个）：');
            if (!urls) return;

            const urlList = urls.split('\n').filter(url => url.trim()).slice(0, 10);

            if (urlList.length === 0) {
                alert('请输入有效的URL');
                return;
            }

            // 显示加载动画
            $('#loadingSpinner').show();
            $('#resultContainer').hide();

            $.ajax({
                url: '/api/batch_detect',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ urls: urlList }),
                success: function(result) {
                    $('#loadingSpinner').hide();
                    displayBatchResults(result);
                },
                error: function(xhr) {
                    $('#loadingSpinner').hide();
                    const error = xhr.responseJSON?.error || '批量检测失败';
                    showError(error);
                }
            });
        }

        // 显示批量检测结果
        function displayBatchResults(result) {
            const container = $('#resultContainer');
            container.empty();

            const summaryCard = $('<div>').addClass('card mb-3');
            summaryCard.html(`
                <div class="card-body">
                    <h5 class="card-title">批量检测结果</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3>${result.total}</h3>
                                <p class="text-muted mb-0">总计</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 class="text-danger">${result.phishing_count}</h3>
                                <p class="text-muted mb-0">钓鱼网站</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 class="text-success">${result.total - result.phishing_count}</h3>
                                <p class="text-muted mb-0">安全网站</p>
                            </div>
                        </div>
                    </div>
                </div>
            `);

            container.append(summaryCard);

            // 显示每个URL的检测结果
            result.results.forEach(function(item) {
                const resultCard = $('<div>').addClass('card mb-2');

                if (item.is_phishing) {
                    resultCard.addClass('border-danger');
                } else {
                    resultCard.addClass('border-success');
                }

                const confidence = (item.confidence * 100).toFixed(1);
                const badgeClass = item.is_phishing ? 'bg-danger' : 'bg-success';
                const badgeText = item.is_phishing ? '钓鱼网站' : '安全网站';

                resultCard.html(`
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">${item.url}</h6>
                                <small class="text-muted">检测时间: ${new Date(item.timestamp).toLocaleString()}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge ${badgeClass}">${badgeText}</span>
                                <div class="mt-1">
                                    <small>置信度: ${confidence}%</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `);

                container.append(resultCard);
            });

            container.show();
        }

        // 回车键触发检测
        $('#urlInput').keypress(function(e) {
            if (e.which === 13) {
                detectWebsite();
            }
        });
    </script>
</body>
</html>