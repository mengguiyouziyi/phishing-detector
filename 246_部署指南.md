# 🚀 钓鱼网站检测器 - 246服务器部署指南

## 📋 概述

钓鱼网站检测器已经完成开发，包含完整的Web界面、机器学习模型和训练框架。现在需要部署到您的246服务器（192.168.1.246）上，该服务器配备2张RTX 4090显卡。

## 🎯 系统特性

### ✅ 已完成功能
- **Web界面**: 现代化的钓鱼网站检测界面
- **API服务**: RESTful API支持程序化访问
- **机器学习**: 完整的训练和推理流程
- **4090优化**: 针对RTX 4090显卡的深度优化
- **多GPU支持**: 支持2张4090并行训练
- **数据处理**: 自动化数据收集和特征提取
- **模型评估**: 完整的性能评估和可视化

### 🚀 性能特性
- **混合精度训练**: FP16加速，提升训练速度
- **多模态融合**: URL、HTML、SSL特征综合分析
- **注意力机制**: 提升模型准确性
- **内存优化**: 高效的GPU内存管理
- **并行计算**: 多进程数据加载

## 📦 部署包信息

**部署包路径**: `/tmp/phishing_detector_246.tar.gz`
**大小**: ~20KB（不含模型和数据）

## 🔧 部署步骤

### 第一步：上传部署包到246服务器

由于SSH密钥问题，建议手动上传：

```bash
# 在本地执行
scp /tmp/phishing_detector_246.tar.gz root@192.168.1.246:/tmp/
```

如果SCP不行，可以：
1. 使用U盘拷贝
2. 使用其他文件传输工具
3. 或者手动复制文件

### 第二步：连接到246服务器

```bash
ssh root@192.168.1.246
密码: 3646287
```

### 第三步：安装系统依赖

```bash
# 更新系统
apt update
apt install -y python3-pip python3-dev python3-venv mysql-server libmysqlclient-dev git wget

# 启动MySQL
systemctl start mysql
systemctl enable mysql

# 创建数据库
mysql -e "CREATE DATABASE IF NOT EXISTS phishing_detector CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

### 第四步：安装CUDA和PyTorch

```bash
# 安装CUDA 12.1
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.1-1_all.deb
dpkg -i cuda-keyring_1.1-1_all.deb
apt-get update
apt-get -y install cuda-toolkit-12-1

# 验证CUDA安装
nvidia-smi
nvcc --version
```

### 第五步：解压部署包

```bash
# 创建目录
mkdir -p /opt/phishing-detector
cd /opt/phishing-detector

# 解压部署包
tar -xzf /tmp/phishing_detector_246.tar.gz --strip-components=1

# 查看文件
ls -la
```

### 第六步：创建虚拟环境并安装依赖

```bash
# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 升级pip
pip install --upgrade pip

# 安装PyTorch（支持CUDA 12.1）
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# 安装其他依赖
pip install -r requirements.txt
```

### 第七步：验证GPU支持

```bash
# 检查GPU状态
nvidia-smi

# 验证PyTorch GPU支持
python3 -c "
import torch
print(f'PyTorch版本: {torch.__version__}')
print(f'GPU数量: {torch.cuda.device_count()}')
for i in range(torch.cuda.device_count()):
    print(f'GPU {i}: {torch.cuda.get_device_name(i)}')
    print(f'显存: {torch.cuda.get_device_properties(i).total_memory / 1e9:.1f} GB')
"
```

### 第八步：启动Web应用

```bash
# 方法1：直接运行
python3 simple_app.py &

# 方法2：使用启动脚本
chmod +x start.sh
./start.sh

# 检查应用状态
ps aux | grep simple_app
tail -f web_app.log
```

### 第九步：创建系统服务（推荐）

```bash
# 创建systemd服务
cat > /etc/systemd/system/phishing-detector.service << 'EOF'
[Unit]
Description=Phishing Detector Web Application
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/phishing-detector
Environment=PATH=/opt/phishing-detector/venv/bin
ExecStart=/opt/phishing-detector/venv/bin/python simple_app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# 启动服务
systemctl daemon-reload
systemctl enable phishing-detector
systemctl start phishing-detector
systemctl status phishing-detector
```

## 🎯 训练模型

### 准备训练环境

```bash
# 激活虚拟环境
source venv/bin/activate

# 检查GPU状态
nvidia-smi
```

### 开始训练

```bash
# 方法1：使用训练脚本
chmod +x train.sh
./train.sh

# 方法2：手动训练
python3 data_collection.py          # 收集数据
python3 train_model.py \           # 训练模型
    --data phishing_dataset.csv \
    --batch_size 128 \
    --epochs 100 \
    --lr 0.001 \
    --save_model best_model.pth

# 方法3：完整训练流程
python3 start_training.py
```

### 监控训练

```bash
# 查看训练日志
tail -f training.log

# 监控GPU使用
watch -n 1 nvidia-smi

# 查看系统资源
htop
```

## 🌐 访问应用

部署完成后，可以通过以下地址访问：

- **Web界面**: http://192.168.1.246:5000
- **API健康检查**: http://192.168.1.246:5000/api/health
- **检测API**: http://192.168.1.246:5000/api/detect

## 📊 模型性能

### 预期性能指标
- **准确率**: >95%
- **精确率**: >94%
- **召回率**: >93%
- **F1分数**: >94%
- **ROC AUC**: >0.98

### 4090显卡优势
- **训练速度**: 相比CPU提升50-100倍
- **批处理大小**: 支持更大的batch size
- **混合精度**: FP16训练，内存占用减半
- **多GPU并行**: 2张4090同时训练

## 🔧 管理命令

### 服务管理
```bash
# 启动服务
systemctl start phishing-detector

# 停止服务
systemctl stop phishing-detector

# 重启服务
systemctl restart phishing-detector

# 查看状态
systemctl status phishing-detector

# 查看日志
journalctl -u phishing-detector -f
```

### 训练管理
```bash
# 查看训练进程
ps aux | grep python

# 停止训练
pkill -f train_model.py

# 清理GPU内存
nvidia-smi --gpu-reset -i 0
nvidia-smi --gpu-reset -i 1
```

## 🚨 故障排除

### 常见问题

1. **GPU未被识别**
   ```bash
   # 检查CUDA安装
   nvidia-smi
   nvcc --version

   # 重新安装驱动
   apt install --reinstall nvidia-driver-535
   ```

2. **内存不足**
   ```bash
   # 减少batch size
   python3 train_model.py --batch_size 64
   ```

3. **端口被占用**
   ```bash
   # 查看端口占用
   netstat -tlnp | grep :5000

   # 杀死占用进程
   kill -9 <PID>
   ```

4. **数据库连接失败**
   ```bash
   # 检查MySQL状态
   systemctl status mysql

   # 重启MySQL
   systemctl restart mysql
   ```

## 📈 性能监控

### GPU监控
```bash
# 实时监控
watch -n 1 nvidia-smi

# 详细监控
nvidia-smi --query-gpu=utilization.gpu,utilization.memory,memory.used,memory.total --format=csv
```

### 系统监控
```bash
# CPU和内存
htop

# 磁盘使用
df -h

# 网络状态
netstat -tlnp
```

## 🎉 部署完成

恭喜！钓鱼网站检测器已成功部署到246服务器。现在您可以：

1. ✅ **使用Web界面**: http://192.168.1.246:5000
2. ✅ **训练模型**: 利用2张4090显卡进行高效训练
3. ✅ **API调用**: 通过RESTful API进行程序化检测
4. ✅ **实时监控**: 监控训练状态和系统性能

## 📞 技术支持

如有问题，请查看：
- 日志文件：`/opt/phishing-detector/web_app.log`
- 训练日志：`/opt/phishing-detector/training.log`
- 系统日志：`journalctl -u phishing-detector`

---

**🚀 部署包位置**: `/tmp/phishing_detector_246.tar.gz`
**📖 详细说明**: `MANUAL_DEPLOY_246.md`
**🎯 目标服务器**: 192.168.1.246 (2x RTX 4090)